<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI_ERAT - Admin Panel Utama</title>
    <style>
        :root { --teal: #008080; --mint: #f5fffa; --orange: #ff9800; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--mint); margin: 0; }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 10px 5%; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo-container { display: flex; align-items: center; text-decoration: none; gap: 10px; cursor: pointer; }
        .logo-icon { background: var(--teal); color: white; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 10px; }
        .logo-text { font-size: 1.2rem; font-weight: bold; color: var(--teal); }
        .nav-links a { color: #555; margin-left: 20px; text-decoration: none; font-weight: 500; }
        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        h2 { color: var(--teal); border-left: 5px solid var(--orange); padding-left: 15px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: var(--teal); color: white; }
        .btn { border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; }
        .btn-approve { background: #28a745; }
        .btn-delete { background: #dc3545; font-size: 0.8rem; }
        .badge { padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .badge-pending { background: #ffeeba; color: #856404; }
        .badge-active { background: #c3e6cb; color: #155724; }
    </style>
</head>
<body>

<nav>
    <div class="logo-container" onclick="pintuRahasia()" title="Klik 3x untuk Akses Darurat">
        <div class="logo-icon">üõ°Ô∏è</div>
        <div class="logo-text">SI_ERAT ADMIN</div>
    </div>
    <div class="nav-links">
        <a href="index.html">üè† Beranda</a>
        <a href="#" style="color:red;" onclick="logout()">Logout</a>
    </div>
</nav>

<div class="container" id="adminContent">
    </div>

<script>
    // 1. Pintu Rahasia untuk masuk jika ditolak
    let klikLogo = 0;
    function pintuRahasia() {
        klikLogo++;
        if (klikLogo === 3) {
            localStorage.setItem('userRole', 'admin');
            localStorage.setItem('username', 'Master_Admin');
            alert("Mode Darurat Aktif! Anda sekarang Admin.");
            location.reload();
        }
        setTimeout(() => { klikLogo = 0; }, 2000);
    }

    // 2. Cek Keamanan saat halaman dimuat
    window.onload = function() {
        const role = localStorage.getItem('userRole');
        
        // Memperbolehkan 'admin' atau 'admin-panel'
        if (role === 'admin' || role === 'admin-panel') {
            tampilkanKontenAdmin();
            muatDataAdmin();
        } else {
            document.getElementById('adminContent').innerHTML = `
                <div class="card" style="text-align:center;">
                    <h2 style="border:none; color:red;">Akses Ditolak!</h2>
                    <p>Hanya Admin yang boleh masuk. Silakan login kembali.</p>
                    <p><small>Tips: Klik logo perisai di pojok kiri atas 3x untuk akses darurat.</small></p>
                    <a href="login.html" class="btn btn-approve" style="text-decoration:none; display:inline-block; margin-top:10px;">Ke Halaman Login</a>
                </div>`;
        }
    };

    function tampilkanKontenAdmin() {
        document.getElementById('adminContent').innerHTML = `
            <div class="card">
                <h2>Persetujuan Akun Baru</h2>
                <p>Guru atau Petugas yang baru daftar akan muncul di sini.</p>
                <table>
                    <thead><tr><th>Nama</th><th>Peran</th><th>Aksi</th></tr></thead>
                    <tbody id="tabelPersetujuan"></tbody>
                </table>
            </div>
            <div class="card">
                <h2>Semua Pengguna & Status</h2>
                <table>
                    <thead><tr><th>Nama</th><th>Peran</th><th>Status</th><th>Aksi</th></tr></thead>
                    <tbody id="tabelSemuaUser"></tbody>
                </table>
            </div>
        `;
    }

    function muatDataAdmin() {
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const tPersetujuan = document.getElementById('tabelPersetujuan');
        const tSemua = document.getElementById('tabelSemuaUser');
        
        tPersetujuan.innerHTML = '';
        tSemua.innerHTML = '';

        users.forEach((u, index) => {
            // Tabel Persetujuan (Hanya yang belum diverif dan bukan siswa)
            if (!u.isVerified && u.role !== 'siswa') {
                tPersetujuan.innerHTML += `
                    <tr>
                        <td><b>${u.username || u.nama}</b></td>
                        <td>${u.role.toUpperCase()}</td>
                        <td><button class="btn btn-approve" onclick="setujuiAkun('${u.username || u.nama}')">Setujui</button></td>
                    </tr>`;
            }

            // Tabel Semua User
            const badge = u.isVerified ? 
                '<span class="badge badge-active">Aktif</span>' : 
                '<span class="badge badge-pending">Menunggu</span>';
            
            tSemua.innerHTML += `
                <tr>
                    <td>${u.username || u.nama}</td>
                    <td>${u.role}</td>
                    <td>${badge}</td>
                    <td><button class="btn-delete" onclick="hapusUser(${index})">Hapus</button></td>
                </tr>`;
        });
    }

    function setujuiAkun(targetName) {
        let users = JSON.parse(localStorage.getItem('users')) || [];
        const idx = users.findIndex(u => (u.username === targetName || u.nama === targetName));
        if (idx !== -1) {
            users[idx].isVerified = true;
            localStorage.setItem('users', JSON.stringify(users));
            alert('Akun ' + targetName + ' berhasil diaktifkan!');
            muatDataAdmin();
        }
    }

    function hapusUser(index) {
        if(confirm("Hapus pengguna ini secara permanen?")) {
            let users = JSON.parse(localStorage.getItem('users')) || [];
            users.splice(index, 1);
            localStorage.setItem('users', JSON.stringify(users));
            muatDataAdmin();
        }
    }

    function logout() {
        localStorage.removeItem('userRole');
        localStorage.removeItem('username');
        window.location.href = 'login.html';
    }
</script>
</body>
</html>